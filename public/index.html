<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Link Shortener</title>
    <style>
      :root {
        --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        --card-bg: #ffffff;
        --primary: #3498db;
        --primary-hover: #2980b9;
        --success: #27ae60;
        --error: #e74c3c;
        --text-main: #2c3e50;
        --text-muted: #7f8c8d;
        --border: #e0e0e0;
        --radius-lg: 16px;
        --radius-md: 8px;
        --radius-sm: 6px;
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.1);
        --focus-ring: 0 0 0 3px rgba(52, 152, 219, 0.2);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-gradient);
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px 20px;
        color: var(--text-main);
      }

      .container {
        width: 100%;
        max-width: 900px;
        background: var(--card-bg);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        padding: 40px;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 10px;
      }
      .subtitle {
        color: var(--text-muted);
        margin-bottom: 30px;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 16px;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--border);
      }

      .tab {
        padding: 10px 20px;
        background: none;
        border: none;
        font-weight: 600;
        color: var(--text-muted);
        cursor: pointer;
      }

      .tab.active {
        color: var(--primary);
        border-bottom: 2px solid var(--primary);
      }

      /* Cards */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
        margin-bottom: 30px;
      }

      .stat-card {
        padding: 20px;
        background: #f8f9fa;
        border-radius: var(--radius-md);
        border: 1px solid var(--border);
      }

      .actions {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }
      label {
        display: block;
        margin-bottom: 8px;
      }

      input,
      select {
        width: 100%;
        padding: 14px;
        font-size: 16px;
        border-radius: var(--radius-md);
        border: 2px solid var(--border);
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: var(--focus-ring);
      }

      button {
        padding: 14px 24px;
        font-size: 16px;
        border-radius: var(--radius-md);
        background: var(--primary);
        color: white;
        border: none;
        cursor: pointer;
      }

      button:hover {
        background: var(--primary-hover);
      }

      /* Link + Domain Cards */
      .link-item,
      .domain-item {
        padding: 14px;
        border-radius: var(--radius-md);
        background: white;
        border: 1px solid var(--border);
        margin-bottom: 10px;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        align-items: center;
      }

      .link-info .short {
        color: var(--primary);
        font-weight: 600;
      }
      .link-meta,
      .domain-meta {
        font-size: 13px;
        color: var(--text-muted);
      }

      .link-actions button {
        background: transparent;
        color: var(--primary);
        padding: 8px 12px;
      }

      .domain-actions button {
        background: transparent;
        color: var(--error);
        padding: 8px 12px;
      }

      #createForm {
        display: none;
      }
      .toast {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: #2c3e50;
        color: white;
        padding: 12px 18px;
        border-radius: 8px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        opacity: 0;
        transform: translateY(10px);
        transition: opacity 0.2s ease, transform 0.2s ease;
        pointer-events: none;
        z-index: 1000;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="tabs">
        <button class="tab active" data-view="dashboard">Dashboard</button>
        <button class="tab" data-view="create">Create Link</button>
        <button class="tab" data-view="domain">Domain</button>
      </div>
      <!-- Dashboard -->
      <div id="dashboardView">
        <h1>Dashboard</h1>
        <p class="subtitle">Manage and monitor your shortened links</p>

        <section class="stats">
          <div class="stat-card">
            <h3>Total Links</h3>
            <div class="value">—</div>
          </div>
          <div class="stat-card">
            <h3>Total Clicks</h3>
            <div class="value">—</div>
          </div>
          <div class="stat-card">
            <h3>Active Today</h3>
            <div class="value">—</div>
          </div>
        </section>

        <section class="actions">
          <input type="url" id="quickUrl" placeholder="Paste a long URL…" />
          <button onclick="quickCreate()">Create</button>
        </section>

        <div class="links-container"></div>
      </div>

      <!-- Domains -->
      <div id="domainSettings" style="display: none">
        <h1>Domain Settings</h1>
        <form id="domainForm" class="form-group">
          <label>Add Custom Domain</label>
          <input id="domain" placeholder="example.com" required />
          <br />
          <br />
          <button>Add Domain</button>
        </form>
        <div class="domains-list"></div>
      </div>

      <!-- Create -->
      <div id="createForm">
        <h1>Create Short Link</h1>

        <form id="linkForm">
          <div class="form-group">
            <label>Long URL</label>
            <input id="url" required />
          </div>

          <div class="form-group">
            <label>Domain</label>
            <select id="domainSelect">
              <option value="">Default domain</option>
            </select>
          </div>

          <div class="form-group">
            <label>Custom Slug</label>
            <input id="slug" />
          </div>

          <button>Create Link</button>
        </form>

        <div id="resultContainer" style="display: none">
          <div id="shortUrl"></div>
          <div id="originalUrl"></div>
        </div>
      </div>
    </div>
    <div id="toast" class="toast">Copied to clipboard</div>
    <script>
      const apiCall = (e, o = {}) =>
        fetch(e, {
          headers: { "Content-Type": "application/json" },
          ...o,
        }).then((r) => r.json());

      function showView(v) {
        dashboardView.style.display = v === "dashboard" ? "block" : "none";
        createForm.style.display = v === "create" ? "block" : "none";
        domainSettings.style.display = v === "domain" ? "block" : "none";
        if (v === "dashboard") loadDashboardData();
        if (v === "domain") loadDomainsData();
      }

      document.querySelectorAll(".tab").forEach(
        (t) =>
          (t.onclick = () => {
            document
              .querySelectorAll(".tab")
              .forEach((x) => x.classList.remove("active"));
            t.classList.add("active");
            showView(t.dataset.view);
          })
      );

      async function loadDashboardData() {
        const links = await apiCall("/api/links");
        document.querySelector(".links-container").innerHTML = links
          .map(
            (l) => `
    <div class="link-item">
      <div>
        <div class="short">${l.domains.domain}/s/${l.links.slug}</div>
        <div class="link-meta">${l.clicks || 0} clicks</div>
      </div>
      <div class="link-actions"><button onclick="copyToClipboard('${
        l.domains.domain
      }/s/${l.links.slug}')">Copy</button></div>
    </div>
  `
          )
          .join("");
      }

      async function loadDomainsData() {
        const domains = await apiCall("/api/domains");
        populateDomainSelect(domains);
        document.querySelector(".domains-list").innerHTML = domains
          .map(
            (d) => `
    <div class="domain-item">
      <div>
        <div class="domain-name">${d.domain}</div>
        <div class="domain-meta">Added ${new Date(
          d.addedAt || Date.now()
        ).toLocaleDateString()}</div>
      </div>
      <div class="domain-actions"><button>Remove</button></div>
    </div>
  `
          )
          .join("");
      }

      function populateDomainSelect(domains) {
        domainSelect.innerHTML = '<option value="">Default domain</option>';
        domains.forEach((d) => {
          const o = document.createElement("option");
          o.value = d.domain;
          o.textContent = d.domain;
          domainSelect.appendChild(o);
        });
      }

      linkForm.onsubmit = async (e) => {
        e.preventDefault();
        const domain = domainSelect.value || location.host;
        const slug = slug.value || undefined;
        const r = await apiCall("/api/links/create", {
          method: "POST",
          body: JSON.stringify({ url: url.value, slug, domain }),
        });
        shortUrl.textContent = `https://${domain}/s/${slug || r.slug}`;
        originalUrl.textContent = url.value;
        resultContainer.style.display = "block";
      };

      function quickCreate() {
        showView("create");
        url.value = quickUrl.value;
      }

      showView("dashboard");

      function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
          const toast = document.getElementById("toast");
          toast.classList.add("show");

          clearTimeout(toast._hideTimeout);
          toast._hideTimeout = setTimeout(() => {
            toast.classList.remove("show");
          }, 2000);
        });
      }
    </script>
  </body>
</html>
